<!DOCTYPE html>
<html>
	<head>
		<title>Hydrowatch</title>

		<link rel="stylesheet" type="text/css" href="css/style.css">

		<script type="text/javascript" src="js/vendor/jquery-2.1.1.min.js"></script>
		<script src="js/vendor/grapho.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script src="js/graphs.js"></script>

		<script>
			var iosocket;

			$(function(){
				iosocket = io.connect();
				iosocket.on('connect', function(){
					iosocket.on('message', function(message){

						if(message.msg == 'states')
						{
							for(var key in message.data.data)
							{
								var name = message.data.data[key][0];
								var data = message.data.data[key][1];
								if(name == 'current_light')
								{
									var color = Math.floor(data * 255);
									$('#light_status').css({"background-color": "rgba(" + [color, color, color, 255].join(",") + ")"});
								}
								if(name == 'light_setting')
								{
									var text = "";
									switch(data)
									{
									case 0:
										text = "off";
										break;
									case 1:
										text = "on";
										break;
									case 2:
										text = "auto";
										break;
									default:
										text = "n/a";
									}
									$('#light_setting').html(text);
								}
								if(name == 'motor-setting')
								{
									
								}
							}
						}
						if(message.msg == 'history')
						{
							var graph = "";
							if(message.data.name == 'water_temperature' || message.data.name == 'water_level')
								graph = 'water_graph';
							else if(message.data.name == 'light_level')
								graph = 'light_graph';
								
							update_graph(graph, message.data.name, message.data.data);
						}
						if(message.msg == 'current')
						{
							$('#' + message.data.name).html(message.data.data);
						}
					});
				});
			});

			function set_light(value)
			{
				iosocket.emit('message', {msg: 'set-light', data: value});
			}
			
			function set_motor(value)
			{
				iosocket.emit('message', {msg: 'set-motor', data: value});
			}

		</script>
	</head>
	<body>
		<div class="panel_container">
			<div class="current_container">
				<div class="left_panel">
					<div id="water_level" class="current_text">
					</div>
				</div>
				<div class="right_panel">
					<div id="water_temperature" class="current_text">
					</div>
				</div>
			</div>
			<div id="water_graph" class="graph">
				<script>create_graph('water_graph');</script>
			</div>
		</div>

		<div class="panel_container">
			<div class="current_container">
				<div class="left_panel">
					<div id="light_level" class="current_text">
					</div>
				</div>
			</div>
			<div id="light_graph" class="graph">
				<script>create_graph('light_graph');</script>
			</div>
		</div>
		<div class="panel_container" id="states">
			<h2>States</h2>
			<div id="states_list"></div>
			<div id="light_status" class="status_box" style="float: left">
				<div class="status_text">Light</div>
				<div id="light_setting" class="status_text">on</div>
			</div>
			<div id="light_status" class="status_box" style="float: left">
				<div class="status_text">Motor</div>
				<div id="motor_setting" class="status_text">silent</div>
			</div>
			<div id="form" style="clear:both">
			<form action="#">
                                <label><input type="radio" name="light" onclick="set_light(1);">Light on</label>
                                <label><input type="radio" name="light" onclick="set_light(0);">Light off</label>
				<label><input type="radio" name="light" onclick="set_light(2);">Light auto</label>
			</form>
			</div>
		</div>
		
		<div class="panel_container" style="clear:both">
			<div class="current_container">
				<div class="left_panel">
					<div id="tds_level" class="current_text">
					</div>
				</div>
			</div>
			<div id="tds_graph" class="graph">
				<script>create_graph('tds_graph');</script>
			</div>
		</div>
		
	</body>
</html>
